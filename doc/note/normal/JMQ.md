jmq是对mq的封装，这里主要是记录一下一个封装应该达到哪些要求和功能：
JMQ是系统技术部消息组自主研发的，提供可靠传递消息及数据的消息中间件平台，具有高的可用性、扩展性和运维性。自十月份正式开始用户接入以来，已经成功接入商品，订单等100个左右重要消息，双十一期间各项指标良好，性能、容量等明显优于老版本的MQ。十一月中旬开始将会大面积的进行切换，以替代老版本的MQ。

特点
1.技术标准

自定义协议规范
zookeeper作为分布式协调器
2.高可用

采用Master/Slave模式部署，支持Failover
采用同步发送、消息持久化，防止数据丢失
消息异步归档到云存储，便于故障跟踪
统一的异常消息重试服务，便于容错
3.高性能

自定义消息序列化，默认开启压缩
批量发送和接收
基于Netty4，采用NIO，EPOLL模型
更轻量级的数据存储模型，消息存储一份，减少拷贝，支持组提交，更快的索引，消息积压不影响写入速度
内存镜像文件，更少的内存拷贝操作
测试数据：
同步刷盘，1K消息体生产TPS为21000，响应时间为0.004秒
异步刷盘，1K消息体生产TPS为53894，响应时间为0.004秒
4.  轻客户端

只和Broker通信
内置管理和性能采集协议
较合理的超时时间设置
批量发送和消费，消费者为拉模式
支持二阶段事务
支持业务ID顺序消费
支持机房部署，就近发送和消费
5.  更完善集群
一组支持多个节点，主、从、备份类型
主从默认同步复制，可以降级为异步复制，备份节点异步复制
更完善的主从选举，从节点可以从Agent同步主节点数据，防止数据不一致
支持从节点和备份节点消费
6.  管理监控

管理端配置消费策略，生产策略，消息回放
更丰富的监控图表
适用场景
系统解耦
非实时系统通信
异步流程处理
注意事项：
               消息可能重复消费，业务系统需要做防止重复消费的处理。

               JMQ默认会消费超时，如果你业务处理慢请在管理端的消费监控中设置确认超时时间，超过该时间消息会被重发拉取


![](http://git.oschina.net/wzj777/princeWiki/raw/master/pic/jd/jd-1.png)

kafka

构建高性能的微博系统——再谈新浪微博架构.pdf